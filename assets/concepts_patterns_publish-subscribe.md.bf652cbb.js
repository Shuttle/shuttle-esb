import { _ as _export_sfc, o as openBlock, c as createElementBlock, a as createStaticVNode } from "./app.c73b04f3.js";
const _imports_0 = "/shuttle-esb/images/publish-subscribe.png";
const __pageData = JSON.parse('{"title":"Publish / Subscribe","description":"","frontmatter":{},"headers":[{"level":2,"title":"Publishing from a web-site","slug":"publishing-from-a-web-site","link":"#publishing-from-a-web-site","children":[]}],"relativePath":"concepts/patterns/publish-subscribe.md"}');
const _sfc_main = { name: "concepts/patterns/publish-subscribe.md" };
const _hoisted_1 = /* @__PURE__ */ createStaticVNode('<h1 id="publish-subscribe" tabindex="-1">Publish / Subscribe <a class="header-anchor" href="#publish-subscribe" aria-hidden="true">#</a></h1><p>When you <code>Send</code> a <em>command</em> shuttle needs to be able to determine the relevant endpoint. The same applies to publishing an event. Shuttle would need to know where to <code>Publish</code> the event to. When sending a command there should be 1, and exactly 1, endpoint that receives the command. When publishing, however, there can be 0 to any number of subscribers.</p><p><img src="' + _imports_0 + '" alt="Publish/Subscribe Image"></p><p>In order to register an endpoint as a subscriber you can either manually configure the subscription store, as recommended for production, or register the subscription using the <code>ISubscriptionService</code> implementation:</p><div class="language-c#"><button class="copy"></button><span class="lang">c#</span><pre><code><span class="line"><span style="color:#A6ACCD;">services</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddServiceBus</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">builder</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=&gt;</span></span>\n<span class="line"><span style="color:#89DDFF;">{</span></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// using type</span></span>\n<span class="line"><span style="color:#A6ACCD;">    builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddSubscription</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">typeof</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Event1</span><span style="color:#89DDFF;">));</span></span>\n<span class="line"><span style="color:#A6ACCD;">    builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddSubscription</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">typeof</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Event2</span><span style="color:#89DDFF;">));</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// using a full type name</span></span>\n<span class="line"><span style="color:#A6ACCD;">    builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddSubscription</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">typeof</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Event1</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">FullName</span><span style="color:#89DDFF;">);</span></span>\n<span class="line"><span style="color:#A6ACCD;">    builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddSubscription</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">typeof</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Event2</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">FullName</span><span style="color:#89DDFF;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// using a generic</span></span>\n<span class="line"><span style="color:#A6ACCD;">    builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddSubscription</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Event1</span><span style="color:#89DDFF;">&gt;();</span></span>\n<span class="line"><span style="color:#A6ACCD;">    builder</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">AddSubscription</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">Event2</span><span style="color:#89DDFF;">&gt;();</span></span>\n<span class="line"><span style="color:#89DDFF;">});</span></span>\n<span class="line"></span></code></pre></div><p>In a production environment it is recommended that the subscription store be maintained manually using an elevated identity. Even though the above configures the required subscriptions it is up to the registered <code>ISubscriptionService</code> implementation to perform the required processing and checks.</p><h1 id="shuttle-configuration" tabindex="-1">Shuttle Configuration <a class="header-anchor" href="#shuttle-configuration" aria-hidden="true">#</a></h1><p>All endpoints that belong to the same physical pub/sub store should connect to the same store.</p><p>You would have a separate store for your development environment, perhaps even locally on your own machine. You would have a separate store for your QA, UAT, and production environments.</p><h2 id="publishing-from-a-web-site" tabindex="-1">Publishing from a web-site <a class="header-anchor" href="#publishing-from-a-web-site" aria-hidden="true">#</a></h2><p>Typically you would publish events from some processing endpoint, as opposed to a web-site.</p><p>That being said, there is nothing stopping you from publishing a message from a web-site. The idea behind publishing a message is that the message represents an event that is typically produced by some <em>processing</em> endpoint. Since a web application should not really be processing anything but rather be <em>sending</em> commands off to a processing endpoint it would stand to reason that a web application should not be publishing events.</p><p>So if you find yourself in a situation where it seems to make sense to publish from your web application it indicates that you need to make a design decision: either the design is not optimal (so the web application is performing processing) <em>or</em> you are constrained in some way the prohibits the implementation of a processing endpoint (maybe a shared hosting environment).</p>', 13);
const _hoisted_14 = [
  _hoisted_1
];
function _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {
  return openBlock(), createElementBlock("div", null, _hoisted_14);
}
const publishSubscribe = /* @__PURE__ */ _export_sfc(_sfc_main, [["render", _sfc_render]]);
export {
  __pageData,
  publishSubscribe as default
};
